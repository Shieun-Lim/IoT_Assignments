<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>My MQTT Page</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body>
<h3>나의 웹(2593249, 임시은)</h3>
<div id="main" style="font-size:20px;"></div>

<script>
    const brokerUrl = 'wss://damoa.io:9002';

    const clientId = 'iot-client-' + Math.random().toString(16).substr(2, 8);

    const options = {
        clientId,
        clean: true,
        connectTimeout: 4000,
        reconnectPeriod: 2000,
        protocol: 'wss'
    };

    console.log("브로커 접속 시도 중:", brokerUrl);
    const client = mqtt.connect(brokerUrl, options);

    client.on('connect', () => {
        console.log("접속 성공!", clientId);

        const topic = 'ewha/2593249';
        client.subscribe(topic, err => {
            if (!err) {
                console.log("구독 성공:", topic);

                client.publish('ewha/checkin', '2593249 임시은');
            }
        });
    });

    client.on('message', (topic, message) => {
        const msg = message.toString();
        console.log("메시지 도착:", msg);

        document.getElementById("main").innerText = msg;
    });

    client.on('error', (err) => {
        console.error("연결 오류:", err);
    });
</script>

</body>
</html>
