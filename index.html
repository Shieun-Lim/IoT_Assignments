<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>MQTT ì‹¤ì‹œê°„ ë°ì´í„°</title>

    <h3>ë‚˜ì˜ ì›¹(2593249 ì„ì‹œì€)</h3>

    <!-- MQTT JavaScript Client -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <style>
        #main {
            font-size: 18px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 90%;
            margin: 20px auto;
            background: #f9f9f9;
        }
    </style>

</head>

<body>

<div id="main">ëŒ€ê¸°ì¤‘...</div>

<script>
    // 1. ë¸Œë¡œì»¤ ì£¼ì†Œ
    const brokerUrl = "wss://damoa.io:9002";

    // 2. ëœë¤ í´ë¼ì´ì–¸íŠ¸ ID
    const clientId = "client_" + Math.random().toString(16).substr(2, 8);

    // 3. MQTT ì—°ê²° ì˜µì…˜
    const options = {
        clientId: clientId,
        clean: true,
        reconnectPeriod: 2000,
    };

    console.log("ğŸ”Œ Connecting to broker...");

    // 4. ì‹¤ì œ MQTT ë¸Œë¡œì»¤ ì—°ê²°
    const client = mqtt.connect(brokerUrl, options);

    // 5. ì—°ê²° ì„±ê³µ
    client.on("connect", () => {
        console.log("âœ… MQTT ì—°ê²° ì„±ê³µ!");

        const topic = "ewha/kim/0317137263";  // â† ì‹¤ì œ í† í”½ìœ¼ë¡œ ë³€ê²½!
        client.subscribe(topic);

        console.log("ğŸ“© êµ¬ë… ì™„ë£Œ:", topic);
        document.getElementById("main").innerHTML = "êµ¬ë…ì¤‘: " + topic;
    });

    // 6. ë©”ì‹œì§€ ë„ì°© ì‹œ í™”ë©´ì— ì¶œë ¥
    client.on("message", (topic, message) => {
        console.log("ğŸ“¨ ë©”ì‹œì§€ ë„ì°©:", message.toString());

        const mainDiv = document.getElementById("main");
        mainDiv.innerHTML = `
            <b>í† í”½:</b> ${topic}<br>
            <b>ë©”ì‹œì§€:</b> ${message.toString()}
        `;
    });

    // 7. ì˜¤ë¥˜ ì²˜ë¦¬
    client.on("error", (err) => {
        console.log("âŒ MQTT ì˜¤ë¥˜:", err);
    });
</script>

</body>
</html>
